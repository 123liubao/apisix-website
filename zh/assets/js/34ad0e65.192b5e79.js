(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{107:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return p})),a.d(t,"toc",(function(){return s})),a.d(t,"default",(function(){return l}));var n=a(3),r=a(7),o=(a(0),a(228)),c={title:"Backend E2E"},p={unversionedId:"back-end-e2e",id:"back-end-e2e",isDocsHomePage:!1,title:"Backend E2E",description:"\x3c!--",source:"@site/docs/apisix-dashboard/back-end-e2e.md",slug:"/back-end-e2e",permalink:"/zh/docs/dashboard/back-end-e2e",version:"current"},s=[{value:"Start with source code",id:"start-with-source-code",children:[]},{value:"Start with docker-compose",id:"start-with-docker-compose",children:[]},{value:"Start test",id:"start-test",children:[]}],i={toc:s};function l(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},i,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"This document describes how to use E2E test locally."),Object(o.b)("h2",{id:"start-with-source-code"},"Start with source code"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"To run back end E2E test, please start the ",Object(o.b)("inlineCode",{parentName:"p"},"manager-api"),", ",Object(o.b)("inlineCode",{parentName:"p"},"apisix"),", ",Object(o.b)("inlineCode",{parentName:"p"},"etcd")," and ",Object(o.b)("inlineCode",{parentName:"p"},"upstream-node")," at first.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"To start the ",Object(o.b)("inlineCode",{parentName:"p"},"manager-api")," project locally, please refer to ",Object(o.b)("a",{parentName:"p",href:"/zh/docs/dashboard/develop"},"develop")," web section.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"To start the etcd locally, please refer to ",Object(o.b)("a",{parentName:"p",href:"https://github.com/apache/apisix/blob/master/docs/en/latest/install-dependencies.md"},"etcd start")," web section.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"To start the ",Object(o.b)("inlineCode",{parentName:"p"},"apisix")," project locally, please refer to ",Object(o.b)("a",{parentName:"p",href:"https://github.com/apache/apisix#get-started"},"apisix start")," web section.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"To start the ",Object(o.b)("inlineCode",{parentName:"p"},"upstream-node")," locally, please install docker in the local environment and execute the command."),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-sh"}," docker run -d --name upstream -v /(Your apisix-dashboard folder path)/api/test/docker/upstream.conf:/etc/nginx/conf.d/default.conf:ro -p 80:80 -p 1980:1980 -p 1981:1981 -p 1982:1982 -p 1983:1983 -p 1984:1984 johz/upstream:v2.0\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"After all the services are started, you can start the back-end E2E test.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"The ",Object(o.b)("inlineCode",{parentName:"p"},"upstream-node")," IP is temporarily changed to the local IP address. After the test, it should be changed to GitHub upstream node IP. If the test case does not involve the upstream node, it does not need to be modified."),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-sh"},' # Local E2E test create route example\n {\n     "uris": ["/test-test"],\n     "name": "route_all",\n     "desc": "test",\n     "methods": ["GET"],\n     "hosts": ["test.com"],\n     "status": 1,\n     "upstream": {\n         "nodes": {\n             # upstream node IP is required for local test\n             "(local ip):1981": 1\n         },\n         "type": "roundrobin"\n      }\n }\n\n  # GitHub E2E test create route example\n {\n     "uris": ["/test-test"],\n     "name": "route_all",\n     "desc": "test",\n     "methods": ["GET"],\n     "hosts": ["test.com"],\n     "status": 1,\n     "upstream": {\n         "nodes": {\n             "172.16.238.20:1981": 1\n         },\n         "type": "roundrobin"\n      }\n }\n')))),Object(o.b)("h2",{id:"start-with-docker-compose"},"Start with docker-compose"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("a",{parentName:"li",href:"https://docs.docker.com/compose/install/"},"install docker-compose"))),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"NOTE:")," In order to run docker compose locally, please change the values of ",Object(o.b)("inlineCode",{parentName:"p"},"listen.host")," and ",Object(o.b)("inlineCode",{parentName:"p"},"etcd.endpoints")," within ",Object(o.b)("inlineCode",{parentName:"p"},"./api/conf/conf.yaml")," as follows:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-sh"},"listen:\n   host: 0.0.0.0\n   port: 9000\netcd:\n   endpoints:\n     - 172.16.238.10:2379\n     - 172.16.238.11:2379\n     - 172.16.238.12:2379\n")),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Use ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose")," to run services such as ",Object(o.b)("inlineCode",{parentName:"p"},"manager-api"),", ",Object(o.b)("inlineCode",{parentName:"p"},"apisix"),", ",Object(o.b)("inlineCode",{parentName:"p"},"etcd")," and ",Object(o.b)("inlineCode",{parentName:"p"},"upstream-node"),", run the command."),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-sh"},"cd /(Your apisix-dashboard folder path)/api/test/docker\ndocker-compose up -d\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"When you use ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose")," to run the local E2E test and need to update the main code, you need to execute the command to close the cluster."),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-sh"},"cd /(Your apisix-dashboard folder path)/api/test/docker\n# -v: Remove links to mount volumes and volumes\ndocker-compose  down -v\n# If you don't want to remove the link between mount volume and volume, you can use\ndocker-compose stop [serviceName]\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Then you need to delete the image of the ",Object(o.b)("inlineCode",{parentName:"p"},"manage-api"),", rebuild the image of the ",Object(o.b)("inlineCode",{parentName:"p"},"manage-api"),", and start the cluster after the image is successfully built."))),Object(o.b)("h2",{id:"start-test"},"Start test"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"After all the services are started, you can start the back-end E2E test.")),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"NOTE:")," Sometimes we need to delete the etcd store info. Otherwise, it will make the test failed."),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Enter the E2E folder and execute the command to test all E2E test files."),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-sh"}," cd /(Your apisix-dashboard folder path)/api/test/e2e\n go test -v\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"You can also do E2E test on a single file."),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-sh"}," cd /(Your apisix-dashboard folder path)/api/test/e2e\n go test -v E2E-test-file.go base.go\n")))))}l.isMDXComponent=!0},228:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return u}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=r.a.createContext({}),l=function(e){var t=r.a.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):p(p({},t),e)),a},b=function(e){var t=l(e.components);return r.a.createElement(i.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,c=e.parentName,i=s(e,["components","mdxType","originalType","parentName"]),b=l(a),m=n,u=b["".concat(c,".").concat(m)]||b[m]||d[m]||o;return a?r.a.createElement(u,p(p({ref:t},i),{},{components:a})):r.a.createElement(u,p({ref:t},i))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,c=new Array(o);c[0]=m;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p.mdxType="string"==typeof e?e:n,c[1]=p;for(var i=2;i<o;i++)c[i]=a[i];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);